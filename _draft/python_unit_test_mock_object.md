# 파이썬 단위 테스트 - Mock 객체  

## 모의 객체와 단위 테스트
### 모의 객체를 사용하는 상황
시스템이 실제로 구동될 때는 데이터베이스, 스토리지 서비스, 외부 API 등 각종 외부 서비스와 연결됩니다.  
외부 서비스를 이용하면 필연적으로 부작용이 발생하며, 이런 부작용을 최소화하기 위해 각종 인터페이스를 통해 추상화하겠지만, 이러한 부분 역시 테스트에 포함되게 됩니다.  
이와 같은 상황에서 모의 객체는 원치 않는 부작용으로부터 테스트 코드를 보호하는 가장 좋은 방법 중 하나입니다.  

### 단위 테스트와 통합테스트의 범위
단위 테스트는 데이터베이스 연결, HTTP 요청을 비롯한 외부 서비스들을 테스트하지 않습니다.  
외부 서비스에 대한 테스트는 작성한 로직에서 벗어날 뿐 아니라 단위 테스트는 빠르게 실행되어야하는데 외부 연결에 대한 대기시간을 기다려야하는 것은 단위 테스트의 취지와 맞지 않습니다.  
그러므로 단위 테스트에서는 외부 서비스 호출에 대한 내부 코드가 정상 동작하는 지 정도만 테스트하며 외부 서비스가 정상 동작하여 올바른 결과를 돌려받는 지에 댁해서는 확인하지 않습니다.  

그렇다면 외부 서비스까지 포함하여 코드 전반을 테스트하는 것은 언제 실행될까요?  
이러한 전체 로직에 걸친 테스트는 통합 테스트에서 수행합니다.  
통합테스트는 아래와 같은 특징을 갖습니다.  
- 통합테스트는 실제 사용자의 행동을 모방하여 더 넓은 관점에서 기능을 테스트합니다.  
- 통합 테스트는 외부 시스템과 서버에 직접 연결하기 때문에 시간이 오래 걸리고 비용이 많이 듭니다.   
- 일반적으로 단위테스트는 많이 & 항상 실행하는 것에 반해 통합 테스트는 덜 자주 실행하며 주로 특별한 이벤트가 발생한 경우 수행합니다.  

### 코드와 단위 테스트의 관련성  
단위 테스트는 보다 나은 코드를 작성하는 데 도움이 되는데, 단위 테스트가 잘 작성된다는 것은 코드가 응집력이 뛰어나고 세분화되어있으며 작게 잘 짜여져있다는 것을 의미합니다.   
또한 테스트를 통해 작성된 코드가 잘못 작성되었는지 여부를 추론 가능합니다.  
만약 간단한 테스트 케이스 작성을 위해 다양한 몽키패치를 해야한다면 코드가 잘못 설계되었다는 신호입니다.  
unittest 모듈은 `unittest.mock.patch`에서 객체를 패치하기 위한 도구를 제공합니다.  
> 패치: import 중에 경로를 지정했던 원본 코드를 모의 객체같은 다른 것으로 대체하는 것  
패치를 하면 런타임 중에 참조되는 코드가 바뀌고 원래 코드와의 연결이 끊어지므로 테스트가 조금 더 어려워지는 단점이 있습니다.  
또한 런타임 시 인터프리터에서 객체를 수정하는 오버헤드도 있기 때문에 성능상의 이슈도 발생할 수 있습니다.  
> 참고로 몽키패치 또는 모의를 사용하는 것 자체가 문제가 되는 것은 아니나 몽키패치를 남용하게 된다면 코드 개선의 여지가 있다고 해석할 수 있습니다.  


